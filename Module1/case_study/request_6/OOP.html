<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 25%;
      }

      td,
      th {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
        width: 2em;
      }
    </style>
  </head>

  <body>
    <h1>Lottery by Me</h1>
    <div class="container"></div>
    <button onclick="buyTicket()">Buy Ticket</button>
    <button onclick="checkResult()">Check Result</button>
    <div id="ticket"></div>
    <script>
      const NUM_TICKETS_MAX = 4;
      let tickets = new Array(NUM_TICKETS_MAX);

      class Ticket {
        static MIN = 1;
        static MAX = 55;
        static N = 6;
        static WIN_NUMBERS = Array(Ticket.N).fill(0);
        static PRIZES = [
          "Good Luck Next Time",
          "Good Luck Next Time",
          "Good Luck Next Time",
          "Consolation prizes with 30$",
          "The second prize with 100$",
          "The first prize with 200$",
          "Jackpot with 100$",
        ];

        constructor() {
          this.numbers = Array(Ticket.N).fill(0);
        }
        randomNumberInRange(min = Ticket.MIN, max = Ticket.MAX) {
          return Math.floor(Math.random() * (max - min) + min);
        }
        sortNumbers(numbers) {
          return numbers.sort((a, b) => a - b);
        }
        chooseNumbsByUser() {
          let set = new Set();
          while (set.size != Ticket.N) {
            let number = parseInt(prompt(`Number ${set.size + 1}`));
            if (number < 0 || number > 100 || set.has(number)) {
              alert("Again. Please input 1 - 55 end not identical");
              continue;
            }
            set.add(number);
          }
          this.numbers = this.sortNumbers([...set]);
          return this.numbers;
        }
        chooseNumbsByMachine() {
          let set = new Set();
          while (set.size != Ticket.N) {
            let number = this.randomNumberInRange();
            set.add(number);
          }
          this.numbers = this.sortNumbers([...set]);
          return this.numbers;
        }
        rollWinNumbers() {
          let set = new Set();
          while (set.size != Ticket.N) {
            let number = this.randomNumberInRange();
            set.add(number);
          }
          Ticket.WIN_NUMBERS = this.sortNumbers([...set]);
        }
        getTicketAsTableContent(numbers = this.numbers) {
          let bodyTable = numbers.map((x) => `<td>${x}</td>`).join("");
          let content = `<table>${bodyTable}</table>`;
          return content;
        }
        getWinTicketAsTableContent() {
          this.rollWinNumbers();
          return this.getTicketAsTableContent(Ticket.WIN_NUMBERS);
        }
        getPrize() {
          const prizeIdx = this.numbers.filter((x) =>
            Ticket.WIN_NUMBERS.includes(x)
          ).length;
          return Ticket.PRIZES[prizeIdx];
        }
      }
      function buyTicket() {
        for (let i = 0; i < NUM_TICKETS_MAX; i++) {
          let choice = parseInt(
            prompt(` You have 3 choice:
      1. You chose number;
      2. You random number;
      3. Quit.`)
          );
          if (choice >= 3 || choice < 1 || choice == "") break;
          tickets[i] = new Ticket();
          if (choice == 1) {
            tickets[i].chooseNumbsByUser();
          } else {
            tickets[i].chooseNumbsByMachine();
          }
        }
        let content = `<h2>YOUR TICKET</h2>`;
        content += tickets.map((x) => x.getTicketAsTableContent()).join("");
        content += `<h2>WIN TICKET</h2>`;
        content += tickets[0].getWinTicketAsTableContent();
        document.getElementById("ticket").innerHTML = content;
      }
      function checkResult() {
        const prizes = Array(NUM_TICKETS_MAX).fill(0);
        const content = tickets
          .map((x, idx) => `Ticket number ${idx + 1} is ${x.getPrize()}`)
          .join("\n");
        alert(content);
      }
    </script>
  </body>
</html>
